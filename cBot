# import re

from nltk.tokenize import sent_tokenize, word_tokenize
from nltk.corpus import stopwords
import nltk
import random

nltk.download('stopwords')
stop_words = set(stopwords.words('english'))

R_EATING = "I don't like eating cause imma bot!"

def unknown():
    resp = ['Could you please rephrase that?',
            '...',
            'Sounds about right',
            'What does that mean'][random.randrange(4)]
    return resp

def find_data(keywrd):
    return 0

def message_probability(usr_mssg, recognised_words, single_response=False, required_words=[]):
    certain = 0.0
    has_required_words = True

    for word in usr_mssg:
        if word in recognised_words:
            certain += 1

    certain /= len(recognised_words)

    for word in required_words:
        if word not in usr_mssg:
            has_required_words = False

    if has_required_words or single_response:
        return int(certain * 100)
    else:
        return 0


def chk_messages(msg):
    highest_prob_list = {}

    def response(bot_response, list_of_words, single_response=False, required_words=[]):
        nonlocal highest_prob_list
        highest_prob_list[bot_response] = message_probability(msg, list_of_words, single_response, required_words)

    response('Hello!', ['hello', 'hi', 'sup', 'hey'], single_response=True)
    response('I\'m doing fine, and you?', ['how', 'are', 'you', 'doing'], required_words=['how'])
    response('Thank you!', ['fuck', 'off'], required_words=['fuck'])
    response(R_EATING, ['what', 'you', 'eat'], required_words=['eat', 'you'])

    match = max(highest_prob_list, key=highest_prob_list.get())
    print(highest_prob_list)

    return unknown() if highest_prob_list[match]<1 else match

def get_response(usr_input):
    words = word_tokenize(usr_input.lower())
    flt_words = []
    for dt in words:
        if dt.lower() in stop_words:
            continue
        elif dt.lower().isalnum():
            flt_words.append(dt.lower)

    response = chk_messages(flt_words)
    return response


while True:
    print('Bot: ' + get_response(input('You: ')))
